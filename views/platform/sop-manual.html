<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SOP Manual - ClosureAI Platform</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/css/admin.css" />
  <link rel="stylesheet" href="/css/platform.css" />
  <style>
    .doc-content {
      max-width: 900px;
    }
    .doc-content h2 {
      font-size: 24px;
      font-weight: 700;
      color: #0f172a;
      margin: 32px 0 16px 0;
      padding-bottom: 8px;
      border-bottom: 2px solid #e2e8f0;
    }
    .doc-content h3 {
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
      margin: 24px 0 12px 0;
    }
    .doc-content h4 {
      font-size: 16px;
      font-weight: 600;
      color: #334155;
      margin: 20px 0 10px 0;
    }
    .doc-content p {
      color: #475569;
      line-height: 1.7;
      margin: 0 0 16px 0;
    }
    .doc-content ul, .doc-content ol {
      color: #475569;
      line-height: 1.7;
      margin: 0 0 16px 0;
      padding-left: 24px;
    }
    .doc-content li {
      margin-bottom: 8px;
    }
    .doc-content code {
      background: #f1f5f9;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 13px;
      color: #0f172a;
    }
    .doc-content pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 0 0 16px 0;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 13px;
      line-height: 1.5;
    }
    .doc-content pre code {
      background: none;
      padding: 0;
      color: inherit;
    }
    .doc-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 0 0 16px 0;
      font-size: 14px;
    }
    .doc-content th, .doc-content td {
      padding: 10px 12px;
      border: 1px solid #e2e8f0;
      text-align: left;
    }
    .doc-content th {
      background: #f8fafc;
      font-weight: 600;
      color: #0f172a;
    }
    .doc-content td {
      color: #475569;
    }
    .doc-toc {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 24px;
    }
    .doc-toc h4 {
      margin: 0 0 12px 0;
      font-size: 14px;
      font-weight: 600;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .doc-toc ul {
      list-style: none;
      padding: 0;
      margin: 0;
      columns: 2;
    }
    .doc-toc li {
      margin-bottom: 8px;
    }
    .doc-toc a {
      color: #6366f1;
      text-decoration: none;
      font-size: 14px;
    }
    .doc-toc a:hover {
      text-decoration: underline;
    }
    .doc-section {
      background: #ffffff;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }
    .doc-section h2:first-child {
      margin-top: 0;
    }
    .checklist {
      list-style: none;
      padding: 0;
    }
    .checklist li {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 8px 0;
    }
    .checklist li::before {
      content: "☐";
      color: #6366f1;
      font-weight: bold;
    }
    .email-template {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
      font-size: 14px;
    }
    .email-template strong {
      display: block;
      margin-bottom: 8px;
      color: #92400e;
    }
    .sql-block {
      background: #1e293b;
      color: #a5f3fc;
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 16px 0;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 13px;
    }
    .warning-box {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
      color: #991b1b;
    }
    .info-box {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
      color: #1e40af;
    }
  </style>
</head>
<body>
  <div class="admin-shell">
    <aside class="admin-sidebar">
      <div class="admin-sidebar-header">
        <a href="/platform" class="admin-sidebar-brand">
          <div class="admin-sidebar-brand-mark"></div>
          <div>
            <div class="admin-sidebar-title">ClosureAI</div>
            <div class="admin-badge">Platform</div>
          </div>
        </a>
      </div>

      <nav class="admin-sidebar-nav">
        <a href="/platform" class="admin-nav-item">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></svg>
          Dashboard
        </a>
        <a href="/platform/pending" class="admin-nav-item">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          Pending Review
        </a>
        <a href="/platform/coaches" class="admin-nav-item">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          All Coaches
        </a>
        <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 16px 0;"></div>
        <a href="/platform/tech-reference" class="admin-nav-item">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
          Tech Reference
        </a>
        <a href="/platform/sop-manual" class="admin-nav-item active">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
          SOP Manual
        </a>
      </nav>

      <div class="admin-sidebar-footer">
        <a href="/dashboard" class="admin-back-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
          Back to App
        </a>
      </div>
    </aside>

    <main class="admin-main">
      <header class="admin-header">
        <h1 class="admin-header-title">SOP Manual</h1>
        <span style="color: #64748b; font-size: 14px;">Platform Owner Standard Operating Procedures</span>
      </header>

      <div class="admin-content doc-content">
        <div class="doc-toc">
          <h4>Table of Contents</h4>
          <ul>
            <li><a href="#daily-operations">Daily Operations</a></li>
            <li><a href="#coach-onboarding">Coach Onboarding</a></li>
            <li><a href="#account-management">Account Management</a></li>
            <li><a href="#custom-domains">Custom Domain Setup</a></li>
            <li><a href="#partner-management">Partner Management</a></li>
            <li><a href="#troubleshooting">Troubleshooting</a></li>
            <li><a href="#technical-ops">Technical Operations</a></li>
          </ul>
        </div>

        <div class="doc-section" id="daily-operations">
          <h2>Daily Operations</h2>

          <h3>Morning Checklist</h3>
          <ul class="checklist">
            <li>Check for pending coach approvals at <a href="/platform/pending">/platform/pending</a></li>
            <li>Review pending commissions on the <a href="/platform">dashboard</a></li>
            <li>Monitor system health via <code>pm2 status</code> and <code>pm2 logs closureai --lines 20</code></li>
          </ul>

          <h3>Weekly Checklist</h3>
          <ul class="checklist">
            <li>Review partner commission payouts</li>
            <li>Check for coaches with no activity (may need follow-up)</li>
            <li>Review any support requests</li>
          </ul>
        </div>

        <div class="doc-section" id="coach-onboarding">
          <h2>Coach Onboarding Process</h2>

          <h3>Approval Workflow</h3>
          <ol>
            <li>Coach pays via Stripe ($2,495 setup + $97/mo)</li>
            <li>Coach fills out onboarding form</li>
            <li>Status changes to <code>pending_review</code></li>
            <li>You review and approve</li>
            <li>Status changes to <code>active</code></li>
            <li>Coach can access <code>/my-app</code></li>
          </ol>

          <h3>Approval Checklist</h3>
          <p>For each pending coach, verify:</p>
          <ul class="checklist">
            <li>Business name makes sense</li>
            <li>Coach name is real</li>
            <li>Subdomain is appropriate (no offensive terms)</li>
            <li>Logo uploaded (or acceptable default)</li>
            <li>Bio is filled out</li>
            <li>At least one offer configured</li>
            <li>Coaching niche is clear</li>
            <li>Target audience defined</li>
          </ul>

          <h3>After Approval: Send Welcome Email</h3>
          <div class="email-template">
            <strong>Subject: Your ClosureAI Coaching App is Live!</strong>
            <p>Hi [Coach Name],</p>
            <p>Great news — your AI coaching app is now live!</p>
            <p><strong>YOUR APP URL:</strong> https://[subdomain].getclosureai.com</p>
            <p><strong>YOUR DASHBOARD:</strong> https://[subdomain].getclosureai.com/my-app</p>
            <p><strong>WHAT TO DO NEXT:</strong></p>
            <ol>
              <li>Log into your dashboard</li>
              <li>Review your branding and offers</li>
              <li>Share your link with clients!</li>
            </ol>
            <p>Welcome aboard!<br>— Keith</p>
          </div>

          <h3>Handling Incomplete Onboarding</h3>
          <p>Find coaches who paid but didn't complete the form:</p>
          <div class="sql-block">SELECT coach_email, created_at, status
FROM apps
WHERE status = 'pending_onboarding'
ORDER BY created_at DESC;</div>
        </div>

        <div class="doc-section" id="account-management">
          <h2>Coach Account Management</h2>

          <h3>Viewing Coaches</h3>
          <p>Go to <a href="/platform/coaches">/platform/coaches</a> to see all coaches. Filter by status:</p>
          <ul>
            <li><code>active</code> - Live and working</li>
            <li><code>pending_review</code> - Awaiting your approval</li>
            <li><code>pending_onboarding</code> - Paid but hasn't completed form</li>
            <li><code>suspended</code> - You suspended them</li>
            <li><code>cancelled</code> - Subscription cancelled</li>
          </ul>

          <h3>Suspending a Coach</h3>
          <div class="warning-box">
            <strong>When to suspend:</strong> Non-payment, Terms of service violation, Coach request
          </div>
          <ol>
            <li>Go to <code>/platform/coaches</code></li>
            <li>Click on the coach</li>
            <li>Click "Suspend Account"</li>
            <li>Their subdomain immediately stops working</li>
            <li>Send notification email to coach</li>
          </ol>

          <h3>Reactivating a Coach</h3>
          <ol>
            <li>Go to <code>/platform/coaches</code></li>
            <li>Click on the coach</li>
            <li>Click "Reactivate Account"</li>
            <li>Status changes to <code>active</code></li>
            <li>Subdomain works again immediately</li>
          </ol>
        </div>

        <div class="doc-section" id="custom-domains">
          <h2>Custom Domain Setup</h2>

          <h3>Requirements from Coach</h3>
          <ul>
            <li>They own the domain</li>
            <li>They can add DNS records</li>
          </ul>

          <h3>Step-by-Step Setup</h3>
          <ol>
            <li><strong>Get domain from coach</strong> - Ask what domain they want (e.g., <code>coaching.yourdomain.com</code>)</li>
            <li><strong>Have coach add DNS record:</strong>
              <pre><code>Type: CNAME
Name: coaching
Value: app.getclosureai.com
TTL: Auto or 3600</code></pre>
            </li>
            <li><strong>Verify DNS propagation:</strong>
              <pre><code>dig coaching.theirdomain.com CNAME</code></pre>
            </li>
            <li><strong>Update Nginx config:</strong>
              <pre><code>sudo nano /etc/nginx/conf.d/closureai.conf
# Add to server_name line</code></pre>
            </li>
            <li><strong>Get SSL certificate:</strong>
              <pre><code>sudo certbot --nginx -d coaching.theirdomain.com</code></pre>
            </li>
            <li><strong>Reload Nginx:</strong>
              <pre><code>sudo nginx -t && sudo systemctl reload nginx</code></pre>
            </li>
            <li><strong>Update database:</strong>
              <div class="sql-block">UPDATE apps
SET custom_domain = 'coaching.theirdomain.com'
WHERE subdomain = 'theirsubdomain';</div>
            </li>
            <li><strong>Confirm with coach</strong> - Send confirmation email</li>
          </ol>
        </div>

        <div class="doc-section" id="partner-management">
          <h2>Partner/Affiliate Management</h2>

          <h3>How Referrals Work</h3>
          <ol>
            <li>Partner signs up at <code>/partners</code></li>
            <li>Partner gets unique referral code</li>
            <li>Partner shares: <code>getclosureai.com/onboard?ref=THEIR_CODE</code></li>
            <li>When coach signs up with that link, <code>partner_id</code> is set</li>
            <li>Commission created: 30% of setup fee ($748.50) + 30% of monthly ($29.10/mo)</li>
          </ol>

          <h3>Paying Out Commissions</h3>
          <ol>
            <li>Review pending commissions on the dashboard</li>
            <li>Send payment via Venmo or PayPal to their <code>payment_handle</code></li>
            <li>Mark as paid via API: <code>PUT /api/admin/commissions/[id]/paid</code></li>
            <li>Optionally notify partner</li>
          </ol>

          <div class="sql-block">-- View pending commissions
SELECT c.id, p.name, p.payment_method, p.payment_handle, c.type, c.amount
FROM commissions c
JOIN partners p ON c.partner_id = p.id
WHERE c.status = 'pending'
ORDER BY c.created_at;</div>
        </div>

        <div class="doc-section" id="troubleshooting">
          <h2>Troubleshooting & Support</h2>

          <h3>Coach Can't Log In</h3>
          <ul class="checklist">
            <li>Check they're using <code>/coach/login</code> not <code>/login</code></li>
            <li>Check account status is <code>active</code></li>
            <li>Check they set up a password during onboarding</li>
          </ul>
          <p><strong>Resolution:</strong> Have them click "Forgot Password" at <code>/coach/login</code></p>

          <h3>User Can't Access Coaching Session</h3>
          <ul class="checklist">
            <li>Is the coach's account <code>active</code>?</li>
            <li>Is the user's account <code>active</code> in users table?</li>
            <li>Has the user verified their email?</li>
          </ul>
          <p><strong>Quick fix - grant access:</strong></p>
          <div class="sql-block">UPDATE users
SET holiday_pass_expires_at = NOW() + INTERVAL '1 year'
WHERE email = 'user@email.com' AND app_id = '[coach_app_id]';</div>

          <h3>Subdomain Not Working</h3>
          <pre><code># Check DNS
dig theirsubdomain.getclosureai.com

# Check Nginx
sudo nginx -t
sudo tail -50 /var/log/nginx/error.log

# Check app is running
pm2 status
pm2 logs closureai --lines 50</code></pre>
        </div>

        <div class="doc-section" id="technical-ops">
          <h2>Technical Operations</h2>

          <h3>Server Access</h3>
          <pre><code>ssh lg-main
cd /var/www/closureai</code></pre>

          <h3>Checking Logs</h3>
          <pre><code># Application logs
pm2 logs closureai --lines 100

# Error logs only
pm2 logs closureai --err --lines 100

# Nginx logs
sudo tail -100 /var/log/nginx/access.log
sudo tail -100 /var/log/nginx/error.log</code></pre>

          <h3>Restarting the App</h3>
          <pre><code>pm2 restart closureai
pm2 status
pm2 logs closureai --lines 20</code></pre>

          <h3>Deploying Updates</h3>
          <pre><code>cd /var/www/closureai
git pull origin main
npm install  # if dependencies changed
pm2 restart closureai
pm2 logs closureai --lines 20</code></pre>

          <h3>Quick Reference URLs</h3>
          <table>
            <tr><th>Purpose</th><th>URL</th></tr>
            <tr><td>Platform Dashboard</td><td><a href="/platform">/platform</a></td></tr>
            <tr><td>Pending Approvals</td><td><a href="/platform/pending">/platform/pending</a></td></tr>
            <tr><td>All Coaches</td><td><a href="/platform/coaches">/platform/coaches</a></td></tr>
            <tr><td>Coach Onboarding</td><td><code>getclosureai.com/onboard</code></td></tr>
            <tr><td>Partner Signup</td><td><code>getclosureai.com/partners</code></td></tr>
          </table>
        </div>
      </div>
    </main>
  </div>
</body>
</html>
