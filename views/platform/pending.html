<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Pending Review - ClosureAI Platform</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/css/admin.css" />
  <link rel="stylesheet" href="/css/platform.css" />
</head>
<body>
  <div class="admin-shell">
    <aside class="admin-sidebar">
      <div class="admin-sidebar-header">
        <a href="/platform" class="admin-sidebar-brand">
          <div class="admin-sidebar-brand-mark"></div>
          <div>
            <div class="admin-sidebar-title">ClosureAI</div>
            <div class="admin-badge">Platform</div>
          </div>
        </a>
      </div>

      <nav class="admin-sidebar-nav">
        <a href="/platform" class="admin-nav-item">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></svg>
          Dashboard
        </a>
        <a href="/platform/pending" class="admin-nav-item active">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          Pending Review
        </a>
        <a href="/platform/coaches" class="admin-nav-item">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          All Coaches
        </a>
        <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 16px 0;"></div>
        <a href="/platform/tech-reference" class="admin-nav-item">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
          Tech Reference
        </a>
        <a href="/platform/sop-manual" class="admin-nav-item">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
          SOP Manual
        </a>
      </nav>

      <div class="admin-sidebar-footer">
        <a href="/dashboard" class="admin-back-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
          Back to App
        </a>
      </div>
    </aside>

    <main class="admin-main">
      <header class="admin-header">
        <h1 class="admin-header-title">Pending Review</h1>
      </header>

      <div class="admin-content">
        <div class="admin-card">
          <div class="admin-card-header">
            <h2 class="admin-card-title">Coaches Awaiting Setup</h2>
          </div>
          <div class="admin-card-body" id="pending-list">
            <div class="admin-loading">
              <div class="admin-spinner"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="/js/admin.js"></script>
  <script>
    async function loadPending() {
      const container = document.getElementById('pending-list');
      try {
        const data = await adminFetch('/api/platform/coaches?status=pending_review');
        const coaches = data.coaches || [];

        if (!coaches.length) {
          container.innerHTML = `
            <div class="admin-empty-state">
              <svg class="admin-empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
              <div class="admin-empty-state-title">All caught up!</div>
              <div class="admin-empty-state-text">No coaches pending review right now.</div>
            </div>
          `;
          return;
        }

        container.innerHTML = `
          <div class="pending-cards">
            ${coaches.map(c => `
              <div class="pending-card">
                <div class="pending-card-header">
                  <div>
                    <div class="pending-card-title">${escapeHtml(c.businessName || 'Unnamed Business')}</div>
                    <div class="pending-card-subtitle">${escapeHtml(c.coachName || '-')} Â· ${escapeHtml(c.coachEmail || '-')}</div>
                  </div>
                  <span class="status-badge status-pending_review">Pending</span>
                </div>
                <div class="pending-card-meta">
                  <span>Domain: ${c.subdomain ? c.subdomain + '.getclosureai.com' : c.customDomain || 'Not set'}</span>
                  <span>Submitted: ${formatRelativeTime(c.createdAt)}</span>
                </div>
                <div class="pending-card-actions">
                  <a href="/platform/coach/${c.id}" class="btn-admin btn-admin-primary">Review & Approve</a>
                </div>
              </div>
            `).join('')}
          </div>
        `;
      } catch (err) {
        console.error('Failed to load pending:', err);
        container.innerHTML = '<p style="color: #ef4444;">Failed to load pending coaches</p>';
      }
    }

    loadPending();
  </script>
</body>
</html>
