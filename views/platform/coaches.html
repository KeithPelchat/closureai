<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>All Coaches - ClosureAI Platform</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/css/admin.css" />
  <link rel="stylesheet" href="/css/platform.css" />
</head>
<body>
  <div class="admin-shell">
    <aside class="admin-sidebar">
      <div class="admin-sidebar-header">
        <a href="/platform" class="admin-sidebar-brand">
          <div class="admin-sidebar-brand-mark"></div>
          <div>
            <div class="admin-sidebar-title">ClosureAI</div>
            <div class="admin-badge">Platform</div>
          </div>
        </a>
      </div>

      <nav class="admin-sidebar-nav">
        <a href="/platform" class="admin-nav-item">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></svg>
          Dashboard
        </a>
        <a href="/platform/pending" class="admin-nav-item">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          Pending Review
        </a>
        <a href="/platform/coaches" class="admin-nav-item active">
          <svg class="admin-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          All Coaches
        </a>
      </nav>

      <div class="admin-sidebar-footer">
        <a href="/dashboard" class="admin-back-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
          Back to App
        </a>
      </div>
    </aside>

    <main class="admin-main">
      <header class="admin-header">
        <h1 class="admin-header-title">All Coaches</h1>
      </header>

      <div class="admin-content">
        <div class="admin-card">
          <div class="admin-card-header">
            <div class="admin-search">
              <svg class="admin-search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
              <input type="text" class="admin-search-input" id="search-input" placeholder="Search coaches..." />
            </div>
            <select class="admin-form-select" id="status-filter" style="width: auto;">
              <option value="">All Statuses</option>
              <option value="pending_onboarding">Pending Onboarding</option>
              <option value="pending_review">Pending Review</option>
              <option value="active">Active</option>
              <option value="suspended">Suspended</option>
            </select>
          </div>
          <div class="admin-card-body admin-table-responsive" id="coaches-table">
            <div class="admin-loading">
              <div class="admin-spinner"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="/js/admin.js"></script>
  <script>
    let allCoaches = [];

    async function loadCoaches() {
      const container = document.getElementById('coaches-table');
      try {
        const data = await adminFetch('/api/platform/coaches');
        allCoaches = data.coaches || [];
        renderCoaches(allCoaches);
      } catch (err) {
        console.error('Failed to load coaches:', err);
        container.innerHTML = '<p style="color: #ef4444;">Failed to load coaches</p>';
      }
    }

    function renderCoaches(coaches) {
      const container = document.getElementById('coaches-table');

      if (!coaches.length) {
        container.innerHTML = '<p style="color: #64748b; text-align: center; padding: 24px;">No coaches found</p>';
        return;
      }

      container.innerHTML = `
        <table class="admin-table">
          <thead>
            <tr>
              <th>Business</th>
              <th>Coach</th>
              <th>Email</th>
              <th>Domain</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${coaches.map(c => `
              <tr>
                <td>${escapeHtml(c.businessName || '-')}</td>
                <td>${escapeHtml(c.coachName || '-')}</td>
                <td>${escapeHtml(c.coachEmail || '-')}</td>
                <td>${c.customDomain || (c.subdomain ? c.subdomain + '.getclosureai.com' : '-')}</td>
                <td><span class="status-badge status-${c.status}">${c.status}</span></td>
                <td>
                  <a href="/platform/coach/${c.id}" class="btn-admin btn-admin-secondary btn-admin-sm">View</a>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    function filterCoaches() {
      const search = document.getElementById('search-input').value.toLowerCase();
      const status = document.getElementById('status-filter').value;

      let filtered = allCoaches;

      if (search) {
        filtered = filtered.filter(c =>
          (c.businessName || '').toLowerCase().includes(search) ||
          (c.coachName || '').toLowerCase().includes(search) ||
          (c.coachEmail || '').toLowerCase().includes(search)
        );
      }

      if (status) {
        filtered = filtered.filter(c => c.status === status);
      }

      renderCoaches(filtered);
    }

    document.getElementById('search-input').addEventListener('input', filterCoaches);
    document.getElementById('status-filter').addEventListener('change', filterCoaches);

    loadCoaches();
  </script>
</body>
</html>
